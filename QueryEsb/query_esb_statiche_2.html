<html lang="it"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QUERY ESB STATICHE</title>
    <link rel="stylesheet" type="text/css" href="query_esb.css">
    <script src="query_esb.js" defer=""></script> <!-- Collegamento al file JavaScript -->
</head>
<body> <!-- Chiamata alla funzione ripristinaTabella() al caricamento della pagina -->
    <div class="title">QUERY ESB</div>
    <!-- Tabella puntamenti -->
    <div class="container">
        <div>
            <div class="database-description">
                Descrizione del database: Inserire qui una breve descrizione del database.
            </div>
            <table id="myTable">
                <thead>
				<tr>
                    <th>Oracle</th>
                    <th>PROD</th>
                    <th>STORICO</th>
                    <th>INT</th>
                    <th>HT</th>
                    <th>Azioni</th>
                </tr>
				</thead>
				<tbody>
                <tr>
                    <td>Host</td>
                    <td>10.55.207.217</td>
                    <td>crm-ora-iv-scan.wind.root.it</td>
                    <td>esbdbs50.wind.root.it</td>
                    <td>esbdbs50.wind.root.it</td>
                    <td>n.a.</td>
                </tr>
                <tr>
                    <td>Port</td>
                    <td>1567</td>
                    <td>1521</td>
                    <td>1522</td>
                    <td>1522</td>
                    <td>n.a.</td>
                </tr>
                <tr>
                    <td>Service Name</td>
                    <td>BWKp_PDB</td>
                    <td>h1esbp_app_service.wind.root.it</td>
                    <td>bwkd_pdbint1</td>
                    <td>bwkd_pdbhf</td>
                    <td>n.a.</td>
                </tr>
						</tbody>
				
				
            </table>
			<p></p>
            <button class="chapter-button" onclick="aggiungiRiga()">Aggiungi Riga</button> <!-- Pulsante per aggiungere una riga -->
        </div>
    </div>

<!-- Indice -->

    <div class="index-container">
        <div class="index-title">Indice
		<button class="chapter-button" onclick="aggiungiParagrafo('-1-')">Aggiungi Capitolo</button>
		</div>
        <ul class="index-list">
            <li class="index-item"><a href="#chapter1">Capitolo 1 - esempio</a>
                <ul class="paragraphs-list">
                    <li><a href="#chapter1-section1">Paragrafo 1.1 - esempio</a></li>
                </ul>
            </li>
            <li class="index-item"><a href="#chapter2">Capitolo 2 - esempio</a>
                <ul class="paragraphs-list">
                    <li><a href="#chapter2-section1">Paragrafo 2.1 - esempio</a></li>
                </ul>
            </li>
        <li class="index-item"><a href="#ID1715260617927">ESTRAZIONE NUMEROSITA PRODOTTI SU ORDINE CRM</a><ul class="paragraphs-list"><li><a href="#ID1715260651464">Estrae i campi dell'ordine e la numerosità dei prodotti a partire da id ordine e nome della action inbound (query 1)</a></li><li><a href="#ID1715260692068">Estrae i campi dell'ordine e la numerosità dei prodotti a partire da id ordine e nome della action inbound (query 2)</a></li></ul></li><li class="index-item"><a href="#ID1715260721793">ESTRAZIONE CASI DI ASSISTENZA TECNICA Sostituzione - Kasko Premium</a><ul class="paragraphs-list"><li><a href="#ID1715260749301">Estrae il cmf-root a partire da una stringa nel payload , dal nome della request e della action</a></li></ul></li><li class="index-item"><a href="#ID1715260758374">ESTRAZIONE EMF ACTION</a><ul class="paragraphs-list"><li><a href="#ID1715260788415">Estrae EMF della action  a partire da una stringa nel payload , e id action</a></li><li><a href="#ID1715260832711">Estrae le informazioni sulla action a partire da id</a></li></ul></li><li class="index-item"><a href="#ID1715260889426">ESTRAZIONE TIED</a><ul class="paragraphs-list"><li><a href="#ID1715260931409">Estrazione dei flag che definiscono gli scenari TIED a partire dalla data e dal nome della request</a></li></ul></li><li class="index-item"><a href="#ID1715260945345">QUERY DISCARD</a><ul class="paragraphs-list"><li><a href="#ID1715260972237">Estrazione dei dettagli della discard a partire dall'id ordine</a></li><li><a href="#ID1715261050684">Estrazione dei dettagli della discard a partire dall'id ordine</a></li><li><a href="#ID1715261142133">Estrazione dei dettagli della discard a partire dal like</a></li></ul></li><li class="index-item"><a href="#ID1715261192860">QUERY PER ESTRAZIONE OLI SU ESB</a><ul class="paragraphs-list"><li><a href="#ID1715261248172">Estrae OLI in maniera gerarchica a partire dall'ordine (query 1)</a></li><li><a href="#ID1715261307256">Estrae OLI in maniera gerarchica a partire dall'ordine (query 2) - storico</a></li></ul></li><li class="index-item"><a href="#ID1715261350759">QUERY PER ESTRAZIONE OGGETTI PROPAGATI AL BILLING</a><ul class="paragraphs-list"><li><a href="#ID1715261748807">Estrazione campi dall'emf verso combilling</a></li></ul></li><li class="index-item"><a href="#ID1715261766624">ESTRAZIONE MEDIANTE REGULAR EXPRESSION</a><ul class="paragraphs-list"><li><a href="#ID1715261793757">Estrazione di un campo dell'action message non ricorsivo</a></li></ul></li><li class="index-item"><a href="#ID1715261801909">ESTRAZIONE RISORSE</a><ul class="paragraphs-list"><li><a href="#ID1715261827681">Estrazione action verso il mobile resource</a></li><li><a href="#ID1715261855210">Estrazione action verso billing dalla request id root</a></li></ul></li></ul>
    </div>

<!-- STRUTTURA Capitolo 1 -->

    <div class="chapter-container" id="chapter1">
        <div class="chapter-title">TITOLO CAPITOLO 1</div>
				<button class="chapter-button" onclick="aggiungiParagrafo('chapter1')">Aggiungi Paragrafo</button>
				<button class="chapter-button" onclick="eliminaParagrafo('chapter1')">Elimina Paragrafo</button>
		
		<!-- STRUTTURA DEL PARAGRAFO -->
		<div class="section" id="chapter1-section1"><div id="chapter1-section1"><div id="chapter1-section1"><div id="chapter1-section1"><div id="chapter1-section1"><div id="chapter1-section1"><div id="chapter1-section1"><div id="chapter1-section1"><div id="chapter1-section1"><div id="chapter1-section1"><div id="chapter1-section1"><div id="chapter1-section1"><div id="chapter1-section1"><div id="chapter1-section1"><div id="chapter1-section1"><div id="chapter1-section1">
			
			<!-- STRUTTURA DEL TITOLO DEL PARAGRAFO -->
			<div class="section-column1">
			
				<div class="section-title">TITOLO PAR.1.1</div>
				<hr>
				<!-- STRUTTURA DELLA QUERY DEL PARAGRAFO -->
				<pre>				<code class="language-sql">
-- Codice PLSQL qui
SELECT * FROM table_name where pippo="pluto";
				</code>
				</pre>
				<!--<button class="chapter-button" onclick="copiaCodice()">Copia codice</button> -->
			</div>
			<p></p> 
			<div class="section-column2">
				<!-- STRUTTURA DELLA TABELLA DI OUTPUT DEL PARAGRAFO -->
				<table>
					<thead>
						<tr>
							<th>Colonna 1</th>
							<th>Colonna 2</th>
							<th>Colonna 3</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td>Dato 1</td>
							<td>Dato 2</td>
							<td>Dato 3</td>
						</tr>
					</tbody>
				</table>
			</div>
			<p></p>
        </div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div>
        <!-- Aggiungi o elimina sottoparagrafo -->
    </div>

    <!-- Capitolo 2 -->
    <div class="chapter-container" id="chapter2">
		       <div class="chapter-title">TITOLO CAPITOLO 2</div>
				<button class="chapter-button" onclick="aggiungiParagrafo('chapter2')">Aggiungi Paragrafo</button>
				<button class="chapter-button" onclick="eliminaParagrafo('chapter2')">Elimina Paragrafo</button>
		

		<!-- STRUTTURA DEL PARAGRAFO -->
        
		<div class="section" id="chapter2-section1"><div id="chapter2-section1"><div id="chapter2-section1"><div id="chapter2-section1"><div id="chapter2-section1"><div id="chapter2-section1"><div id="chapter2-section1"><div id="chapter2-section1"><div id="chapter2-section1"><div id="chapter2-section1"><div id="chapter2-section1"><div id="chapter2-section1"><div id="chapter2-section1"><div id="chapter2-section1"><div id="chapter2-section1"><div id="chapter2-section1">
			
			<!-- STRUTTURA DEL TITOLO DEL PARAGRAFO -->
			
			<div class="section-column1">
			
				<div class="section-title">TITOLO PAR.2.1</div>
				<hr>
				<!-- STRUTTURA DELLA QUERY DEL PARAGRAFO -->
				
				<pre>				<code class="language-sql">
-- Codice PLSQL qui
SELECT * FROM table_name where pippo="pluto";
				</code>
				</pre>
			</div>
			<p></p> 
			
			<div class="section-column2">
				
				<!-- STRUTTURA DELLA TABELLA DI OUTPUT DEL PARAGRAFO -->
				
				<table>
					<thead>
						<tr>
							<th>Colonna 1</th>
							<th>Colonna 2</th>
							<th>Colonna 3</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td>Dato 1</td>
							<td>Dato 2</td>
							<td>Dato 3</td>
						</tr>
					</tbody>
				</table>
			</div>
<p></p>
        </div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div>
        <!-- Aggiungi o elimina sottoparagrafo -->
    </div>



<div class="chapter-container" id="ID1715260617927"><div class="chapter-title">ESTRAZIONE NUMEROSITA PRODOTTI SU ORDINE CRM(ID1715260617927)</div><button class="chapter-button">Aggiungi Paragrafo</button><button class="chapter-button">Elimina Paragrafo</button><div class="section" id="ID1715260651464"><div class="section-column1"><div class="section-title">Estrae i campi dell'ordine e la numerosità dei prodotti a partire da id ordine e nome della action inbound (query 1) (ID1715260651464)</div><hr><pre><code class="language-sql">select --am.*,
r.id,r.status,r.name,r.ts_created,
extractValue(xmltype(message_xml),'commercialOrder/order/@tipo','xmlns="http://phoenix.wind.it/esb/CommercialOrder"')as tipo_ordine,
extractValue(xmltype(message_xml),'commercialOrder/order/@sottotipo','xmlns="http://phoenix.wind.it/esb/CommercialOrder"') as sottotipo_ordine,
extractValue(xmltype(message_xml),'commercialOrder/order/@causaleOrdine','xmlns="http://phoenix.wind.it/esb/CommercialOrder"') as causale_ordine,
extractValue(xmltype(message_xml),'commercialOrder/order/@bssOrder','xmlns="http://phoenix.wind.it/esb/CommercialOrder"') as bss_order,
extractValue(xmltype(message_xml),'commercialOrder/order/@flagSospensione','xmlns="http://phoenix.wind.it/esb/CommercialOrder"') as flag_sospensione,
(select count(id) from request where name='Network' and root_id=rr.root_id) as count_network,
(case when (select count (id) from request where name='Logistics' and root_id=rr.root_id)&gt;=1 then 'Y' else 'N' end) as Logistica,
(SELECT count(*) FROM action_msg b, TABLE ( XMLSEQUENCE ( EXTRACT ( xmltype (b.message_xml), '/commercialOrder/order/lineItem[@sottoTipo=''WLESSPREPAG'']',   'xmlns="http://phoenix.wind.it/esb/CommercialOrder"  '))) p  where  b.id=am.id) num_prd_wlessprep,
(SELECT count(*) FROM action_msg b, TABLE ( XMLSEQUENCE ( EXTRACT ( xmltype (b.message_xml), '/commercialOrder/order/lineItem[@sottoTipo=''WLESS'']',   'xmlns="http://phoenix.wind.it/esb/CommercialOrder"  '))) p  where  b.id=am.id) num_prd_wless,
(SELECT count(*) FROM action_msg b, TABLE ( XMLSEQUENCE ( EXTRACT ( xmltype (b.message_xml), '/commercialOrder/order/lineItem[@sottoTipo=''CPEM'']',   'xmlns="http://phoenix.wind.it/esb/CommercialOrder"  '))) p  where  b.id=am.id) num_prd_cpem,
(SELECT count(*) FROM action_msg b, TABLE ( XMLSEQUENCE ( EXTRACT ( xmltype (b.message_xml), '/commercialOrder/order/lineItem[@sottoTipo=''GSS'']',   'xmlns="http://phoenix.wind.it/esb/CommercialOrder"  '))) p  where  b.id=am.id) num_prd_gss
,extractvalue(value(te),'./*[@tipo=''TE'']/@componentRoot','xmlns="http://phoenix.wind.it/esb/CommercialOrder"') componentRoot
,extractvalue(value(te),'./*[@tipo=''TE'']/@integrationId','xmlns="http://phoenix.wind.it/esb/CommercialOrder"') integrationIdTe
,extractvalue(value(te),'./*[@tipo=''TE'']/@sottoTipo','xmlns="http://phoenix.wind.it/esb/CommercialOrder"') sottoTipote
,extractvalue(value(te),'./*[@tipo=''TE'']/@componentPadre','xmlns="http://phoenix.wind.it/esb/CommercialOrder"') componentPadrete
,extractvalue(value(te),'./*[@tipo=''TE'']/nomeAttributo[.="Numero Voce Portato"]/@valore','xmlns="http://phoenix.wind.it/esb/CommercialOrder"') numeroVocePortato
,extractvalue(value(te),'./*[@tipo=''TE'']/nomeAttributo[.="Numero Voce Precedente"]/@valore','xmlns="http://phoenix.wind.it/esb/CommercialOrder"') numeroVocePrecedente
--,extractvalue(value(te),'./*[@tipo=''TE'']/@numeroVocePrecedente','xmlns="http://phoenix.wind.it/esb/CommercialOrder"') numeroVocePrecedente
,r.id
from action r, request rr ,action_msg am,
--TABLE ( XMLSEQUENCE(EXTRACT(xmltype(am.message_xml),'/commercialOrder/order/descendant::*[@tipo=''PRD'']',
--'xmlns="http://phoenix.wind.it/esb/CommercialOrder"'))) p,
TABLE ( XMLSEQUENCE(EXTRACT(xmltype(am.message_xml),'/commercialOrder/order/descendant::*[@tipo=''TC'']','xmlns="http://phoenix.wind.it/esb/CommercialOrder"'))) pp    
,TABLE ( XMLSEQUENCE(EXTRACT(xmltype(am.message_xml),'/commercialOrder/order/descendant::*[@tipo=''TE'' and @sottoTipo="MNPIN"]','xmlns="http://phoenix.wind.it/esb/CommercialOrder"'))) te    
where r.name='Receive In Order'--'Receive Out Order'
and r.status='SA'
--and r.ts_created&gt;sysdate-10
and RR.ID=r.request_id
--and rr.root_id=3449071259
and am.id=r.message_id
and rownum&lt;3
--and r.id='3450777873'
and rr.root_id = (select distinct root_id from detail where value='1-620245797028')</code></pre></div><p></p><div class="section-column2"><table><thead><tr class="first-row"><th>ID</th><th>STATUS</th><th>NAME</th><th>TS_CREATED</th><th>TIPO_ORDINE</th><th>SOTTOTIPO_ORDINE</th><th>CAUSALE_ORDINE</th><th>BSS_ORDER</th><th>FLAG_SOSPENSIONE</th><th>COUNT_NETWORK</th><th>LOGISTICA</th><th>NUM_PRD_WLESSPREP</th><th>NUM_PRD_WLESS</th><th>NUM_PRD_CPEM</th><th>NUM_PRD_GSS</th><th>COMPONENTROOT</th><th>INTEGRATIONIDTE</th><th>SOTTOTIPOTE</th><th>COMPONENTPADRETE</th><th>NUMEROVOCEPORTATO</th><th>NUMEROVOCEPRECEDENTE</th><th>ID_1</th></tr></thead><tbody><tr><td>69358095650</td><td>SA</td><td>Receive In Order</td><td>19/03/2024 20:13:27,306712</td><td>Attivazione</td><td>Attivazione</td><td>Prima Attivazione</td><td>Y</td><td>0</td><td>0</td><td>N</td><td>4</td><td>0</td><td>0</td><td>0</td><td>1620247392464</td><td>1620247392500</td><td>MNPIN</td><td>1620247392483</td><td>3200413230</td><td>3298328083</td><td>69358095650</td></tr><tr><td>69358095650</td><td>SA</td><td>Receive In Order</td><td>19/03/2024 20:13:27,306712</td><td>Attivazione</td><td>Attivazione</td><td>Prima Attivazione</td><td>Y</td><td>0</td><td>0</td><td>N</td><td>4</td><td>0</td><td>0</td><td>0</td><td>1620247392541</td><td>1620247392577</td><td>MNPIN</td><td>1620247392560</td><td>3339333556</td><td>3299035517</td><td>69358095650</td></tr></tbody></table></div><p></p></div><div class="section" id="ID1715260692068"><div class="section-column1"><div class="section-title">Estrae i campi dell'ordine e la numerosità dei prodotti a partire da id ordine e nome della action inbound (query 2) (ID1715260692068)</div><hr><pre><code class="language-sql">select --am.*,
r.id,r.status,r.name,r.ts_created,
extractValue(xmltype(message_xml),'commercialOrder/order/@tipo','xmlns="http://phoenix.wind.it/esb/CommercialOrder"')as tipo_ordine,
extractValue(xmltype(message_xml),'commercialOrder/order/@sottotipo','xmlns="http://phoenix.wind.it/esb/CommercialOrder"') as sottotipo_ordine,
extractValue(xmltype(message_xml),'commercialOrder/order/@causaleOrdine','xmlns="http://phoenix.wind.it/esb/CommercialOrder"') as causale_ordine,
extractValue(xmltype(message_xml),'commercialOrder/order/@bssOrder','xmlns="http://phoenix.wind.it/esb/CommercialOrder"') as bss_order,
extractValue(xmltype(message_xml),'commercialOrder/order/@flagSospensione','xmlns="http://phoenix.wind.it/esb/CommercialOrder"') as flag_sospensione,
(select count(id) from request where name='Network' and root_id=rr.root_id) as count_network,
(case when (select count (id) from request where name='Logistics' and root_id=rr.root_id)&gt;=1 then 'Y' else 'N' end) as Logistica,
(SELECT count(*) FROM action_msg b, TABLE ( XMLSEQUENCE ( EXTRACT ( xmltype (b.message_xml), '/commercialOrder/order/lineItem[@sottoTipo=''WLESSPREPAG'']',   'xmlns="http://phoenix.wind.it/esb/CommercialOrder"  '))) p  where  b.id=am.id) num_prd_wlessprep,
(SELECT count(*) FROM action_msg b, TABLE ( XMLSEQUENCE ( EXTRACT ( xmltype (b.message_xml), '/commercialOrder/order/lineItem[@sottoTipo=''WLESS'']',   'xmlns="http://phoenix.wind.it/esb/CommercialOrder"  '))) p  where  b.id=am.id) num_prd_wless,
(SELECT count(*) FROM action_msg b, TABLE ( XMLSEQUENCE ( EXTRACT ( xmltype (b.message_xml), '/commercialOrder/order/lineItem[@sottoTipo=''CPEM'']',   'xmlns="http://phoenix.wind.it/esb/CommercialOrder"  '))) p  where  b.id=am.id) num_prd_cpem,
(SELECT count(*) FROM action_msg b, TABLE ( XMLSEQUENCE ( EXTRACT ( xmltype (b.message_xml), '/commercialOrder/order/lineItem[@sottoTipo=''GSS'']',   'xmlns="http://phoenix.wind.it/esb/CommercialOrder"  '))) p  where  b.id=am.id) num_prd_gss,
extractvalue(value(p),'./*[@tipo=''PRD'']/@integrationId','xmlns="http://phoenix.wind.it/esb/CommercialOrder"') integrationIdPrd
,extractvalue(value(p),'./*[@tipo=''PRD'']/@id','xmlns="http://phoenix.wind.it/esb/CommercialOrder"') rowIdPRD
,extractvalue(value(p),'descendant::*/*/@serviceId','xmlns="http://phoenix.wind.it/esb/CommercialOrder"') serviceIdPRD
,extractvalue(value(p),'descendant::*/*[@tipo=''TC'' and @sottoTipo="SRVPREPMOB"]/nomeAttributo[.="MSISDN"]/@valore','xmlns="http://phoenix.wind.it/esb/CommercialOrder"') msisdn
,extractvalue(value(p),'descendant::*/*[@tipo=''TC'' and @sottoTipo="SRVPREPMOB"]/@serviceId','xmlns="http://phoenix.wind.it/esb/CommercialOrder"') serviceIdTC
,extractvalue(value(p),'descendant::*/*[@tipo=''TE'']/nomeAttributo[.="Numero Voce Portato"]/@valore','xmlns="http://phoenix.wind.it/esb/CommercialOrder"') numeroVocePortato
,extractvalue(value(p),'descendant::*/*[@tipo=''TE'']/nomeAttributo[.="Numero Voce Precedente"]/@valore','xmlns="http://phoenix.wind.it/esb/CommercialOrder"') numeroVocePrecedente
,r.id
from action r, request rr ,action_msg am,
TABLE ( XMLSEQUENCE(EXTRACT(xmltype(am.message_xml),'/commercialOrder/order/descendant::*[@tipo=''PRD'']','xmlns="http://phoenix.wind.it/esb/CommercialOrder"'))) p
where r.name='Receive In Order'--'Receive Out Order'
and r.status='SA'
--and r.ts_created&gt;sysdate-10
and RR.ID=r.request_id
--and rr.root_id=3449071259
and am.id=r.message_id
and rownum&lt;3
--and r.id='3450777873'
and rr.root_id = (select distinct root_id from detail where value='1-620245797028')</code></pre></div><p></p><div class="section-column2"><table><thead><tr class="first-row"><th>ID</th><th>STATUS</th><th>NAME</th><th>TS_CREATED</th><th>TIPO_ORDINE</th><th>SOTTOTIPO_ORDINE</th><th>CAUSALE_ORDINE</th><th>BSS_ORDER</th><th>FLAG_SOSPENSIONE</th><th>COUNT_NETWORK</th><th>LOGISTICA</th><th>NUM_PRD_WLESSPREP</th><th>NUM_PRD_WLESS</th><th>NUM_PRD_CPEM</th><th>NUM_PRD_GSS</th><th>INTEGRATIONIDPRD</th><th>ROWIDPRD</th><th>SERVICEIDPRD</th><th>MSISDN</th><th>SERVICEIDTC</th><th>NUMEROVOCEPORTATO</th><th>NUMEROVOCEPRECEDENTE</th><th>ID_1</th></tr></thead><tbody><tr><td>69358095650</td><td>SA</td><td>Receive In Order</td><td>19/03/2024 20:13:27,306712</td><td>Attivazione</td><td>Attivazione</td><td>Prima Attivazione</td><td>Y</td><td>0</td><td>0</td><td>N</td><td>4</td><td>0</td><td>0</td><td>0</td><td>1620247392464</td><td>1-7WXRA6Z4</td><td>3298328083</td><td>3298328083</td><td>3298328083</td><td>3200413230</td><td>3298328083</td><td>69358095650</td></tr><tr><td>69358095650</td><td>SA</td><td>Receive In Order</td><td>19/03/2024 20:13:27,306712</td><td>Attivazione</td><td>Attivazione</td><td>Prima Attivazione</td><td>Y</td><td>0</td><td>0</td><td>N</td><td>4</td><td>0</td><td>0</td><td>0</td><td>1620247392541</td><td>1-7WXRA719</td><td>3299035517</td><td>3299035517</td><td>3299035517</td><td>3339333556</td><td>3299035517</td><td>69358095650</td></tr></tbody></table></div><p></p></div></div><div class="chapter-container" id="ID1715260721793"><div class="chapter-title">ESTRAZIONE CASI DI ASSISTENZA TECNICA Sostituzione - Kasko Premium(ID1715260721793)</div><button class="chapter-button">Aggiungi Paragrafo</button><button class="chapter-button">Elimina Paragrafo</button><div class="section" id="ID1715260749301"><div class="section-column1"><div class="section-title">Estrae il cmf-root a partire da una stringa nel payload , dal nome della request e della action (ID1715260749301)</div><hr><pre><code class="language-sql">select a.*,substr(d.document_xml,1,20) from action a, request b , request c ,request_doc d
where 
1=1 and 
a.name='Send order odsn' and 
a.ts_created&gt;sysdate-90 and rownum&lt;3 and
a.request_id=b.id and
b.root_id=c.id and 
d.id=c.document_id and
d.document_xml like '%Sostituzione - Kasko Premium%' and
c.name='Sim/Handset Change'</code></pre></div><p></p><div class="section-column2"><table><thead><tr class="first-row"><th>ID</th><th>NAME</th><th>DIRECTION</th><th>STATUS</th><th>TS_REQUESTED</th><th>TS_CREATED</th><th>TS_ENQUEUED</th><th>TS_FIRST_START</th><th>TS_START</th><th>TS_END</th><th>PRIORITY</th><th>TS_TODO</th><th>QUEUE</th><th>REQUEST_ID</th><th>MESSAGE_ID</th><th>SYSTEM</th><th>CFG_ID</th><th>HANDLER</th><th>RESPONSE_ID</th><th>ADB_SOURCE</th><th>RESULT</th><th>SUBSTR(D.DOCUMENT_XML,1,20)</th></tr></thead><tbody><tr><td>69782045179</td><td>Send order odsn</td><td>outbound</td><td>SA</td><td>03/05/2024 11:53:27,000000</td><td>03/05/2024 11:53:27,468779</td><td></td><td>03/05/2024 11:53:27,000000</td><td>03/05/2024 11:53:27,000000</td><td>03/05/2024 11:53:38,000000</td><td>1</td><td></td><td>queue.sn.crp.out</td><td>3505456192</td><td>-33397877252</td><td>snow</td><td>7275</td><td>/esb2sap/process/businessService/OrderManagement/bwBSInvioOrdineSNOut.process</td><td></td><td></td><td></td><td>&lt;?xml version="1.0"</td></tr><tr><td>69690745292</td><td>Send order odsn</td><td>outbound</td><td>SA</td><td>22/04/2024 13:12:24,000000</td><td>22/04/2024 13:12:24,136009</td><td></td><td>22/04/2024 13:12:24,000000</td><td>22/04/2024 13:12:24,000000</td><td>22/04/2024 13:12:29,000000</td><td>1</td><td></td><td>queue.sn.crp.out</td><td>3498803901</td><td>-33311765042</td><td>snow</td><td>7275</td><td>/esb2sap/process/businessService/OrderManagement/bwBSInvioOrdineSNOut.process</td><td></td><td></td><td></td><td>&lt;?xml version="1.0"</td></tr></tbody></table></div><p></p></div></div><div class="chapter-container" id="ID1715260758374"><div class="chapter-title">ESTRAZIONE EMF ACTION(ID1715260758374)</div><button class="chapter-button">Aggiungi Paragrafo</button><button class="chapter-button">Elimina Paragrafo</button><div class="section" id="ID1715260788415"><div class="section-column1"><div class="section-title">Estrae EMF della action  a partire da una stringa nel payload , e id action (ID1715260788415)</div><hr><pre><code class="language-sql">select a.*,substr(b.message_xml,1,20)  from action a , action_msg b where b.id=a.message_id 
and b.message_xml like '%32%' and direction='outbound' and system='sdm' and a.ts_created&gt;sysdate-90 and rownum&lt;3
--and a.id=69159398618</code></pre></div><p></p><div class="section-column2"><table><thead><tr class="first-row"><th>ID</th><th>NAME</th><th>DIRECTION</th><th>STATUS</th><th>TS_REQUESTED</th><th>TS_CREATED</th><th>TS_ENQUEUED</th><th>TS_FIRST_START</th><th>TS_START</th><th>TS_END</th><th>PRIORITY</th><th>TS_TODO</th><th>QUEUE</th><th>REQUEST_ID</th><th>MESSAGE_ID</th><th>SYSTEM</th><th>CFG_ID</th><th>HANDLER</th><th>RESPONSE_ID</th><th>ADB_SOURCE</th><th>RESULT</th><th>SUBSTR(B.MESSAGE_XML,1,20)</th></tr></thead><tbody><tr><td>69697917247</td><td>Modify technical services</td><td>outbound</td><td>SA</td><td>23/04/2024 08:38:51,000000</td><td>23/04/2024 08:38:49,861836</td><td></td><td>23/04/2024 08:38:51,000000</td><td>23/04/2024 08:38:51,000000</td><td>23/04/2024 08:38:52,000000</td><td>1</td><td></td><td>queue.sdm.out</td><td>3499305570</td><td>-33318433178</td><td>sdm</td><td>455</td><td>/esb2sdm/process/businessService/bwBSInvioOrdineSdmOut.process</td><td></td><td></td><td></td><td>&lt;?xml version="1.0"</td></tr><tr><td>69697980576</td><td>Modify technical services</td><td>outbound</td><td>SA</td><td>23/04/2024 08:56:00,000000</td><td>23/04/2024 08:55:59,574940</td><td></td><td>23/04/2024 08:56:01,000000</td><td>23/04/2024 08:56:01,000000</td><td>23/04/2024 08:56:01,000000</td><td>1</td><td></td><td>queue.sdm.out</td><td>3499309540</td><td>-33318493123</td><td>sdm</td><td>455</td><td>/esb2sdm/process/businessService/bwBSInvioOrdineSdmOut.process</td><td></td><td></td><td></td><td>&lt;?xml version="1.0"</td></tr></tbody></table></div><p></p></div><div class="section" id="ID1715260832711"><div class="section-column1"><div class="section-title">Estrae le informazioni sulla action a partire da id (ID1715260832711)</div><hr><pre><code class="language-sql">select * from action a where a.request_id='3498943463' and rownum&lt;3</code></pre></div><p></p><div class="section-column2"><table><thead><tr class="first-row"><th>ID</th><th>NAME</th><th>DIRECTION</th><th>STATUS</th><th>TS_REQUESTED</th><th>TS_CREATED</th><th>TS_ENQUEUED</th><th>TS_FIRST_START</th><th>TS_START</th><th>TS_END</th><th>PRIORITY</th><th>TS_TODO</th><th>QUEUE</th><th>REQUEST_ID</th><th>MESSAGE_ID</th><th>SYSTEM</th><th>CFG_ID</th><th>HANDLER</th><th>RESPONSE_ID</th><th>ADB_SOURCE</th><th>RESULT</th></tr></thead><tbody><tr><td>3345784527</td><td>Send Transmission Status</td><td>outbound</td><td>TD</td><td>06/12/2012 09:21:14,631000</td><td>06/12/2012 09:21:15,103175</td><td></td><td></td><td></td><td></td><td>1</td><td></td><td>queue.siebel.out</td><td>389488327</td><td></td><td>siebel</td><td>3036</td><td>/esb2siebel/process/businessService/ContactManagement/bwBSNewIntOutbCnsOut.process</td><td></td><td></td><td></td></tr><tr><td>4405408381</td><td>Receive Response From XCOM</td><td>inbound</td><td>TD</td><td>03/04/2013 03:52:20,179000</td><td>03/04/2013 03:52:20,412032</td><td></td><td></td><td></td><td></td><td>1</td><td></td><td>queue.xcom.in</td><td>489761786</td><td></td><td>xcom</td><td>3046</td><td>/esb2xcom/process/businessService/Consumer/ContactManagement/bwBSGetXcomResponseIn.process</td></tr></tbody></table></div><p></p></div></div><div class="chapter-container" id="ID1715260889426"><div class="chapter-title">ESTRAZIONE TIED(ID1715260889426)</div><button class="chapter-button">Aggiungi Paragrafo</button><button class="chapter-button">Elimina Paragrafo</button><div class="section" id="ID1715260931409"><div class="section-column1"><div class="section-title">Estrazione dei flag che definiscono gli scenari TIED a partire dalla data e dal nome della request (ID1715260931409)</div><hr><pre><code class="language-sql">select * from(
select /* PARALLEL (64) */
root.id as root_id,
root.name as root_name,
root.ts_created as root_ts_created,
extractvalue((xmltype(doc.document_xml)),'ns0:commercialOrderCns/ns0:order/ns0:mobile/ns0:servizioMobile/@idBAnrc','xmlns:ns0="http://phoenix.wind.it/common/commercialOrderCns/cmfSchema.xsd"') id_BA_nrc,
extractvalue((xmltype(doc.document_xml)),'ns0:commercialOrderCns/ns0:order/ns0:mobile/ns0:servizioMobile/@idBAnrcOld','xmlns:ns0="http://phoenix.wind.it/common/commercialOrderCns/cmfSchema.xsd"') id_BA_nrc_Old,
extractvalue((xmltype(doc.document_xml)),'ns0:commercialOrderCns/ns0:order/ns0:mobile/ns0:servizioMobile/@idBArc','xmlns:ns0="http://phoenix.wind.it/common/commercialOrderCns/cmfSchema.xsd"') id_BA_rc,
extractvalue((xmltype(doc.document_xml)),'ns0:commercialOrderCns/ns0:order/ns0:mobile/ns0:servizioMobile/@idBArcOld','xmlns:ns0="http://phoenix.wind.it/common/commercialOrderCns/cmfSchema.xsd"') id_BA_rc_Old,
extractvalue((xmltype(doc.document_xml)),'ns0:commercialOrderCns/ns0:order/ns0:mobile/ns0:servizioMobile/@idBAusg','xmlns:ns0="http://phoenix.wind.it/common/commercialOrderCns/cmfSchema.xsd"') id_BA_usg,
extractvalue((xmltype(doc.document_xml)),'ns0:commercialOrderCns/ns0:order/ns0:mobile/ns0:servizioMobile/@idBAusgOld','xmlns:ns0="http://phoenix.wind.it/common/commercialOrderCns/cmfSchema.xsd"') id_BA_usg_Old,
extractvalue((xmltype(doc.document_xml)),'ns0:commercialOrderCns/ns0:order/ns0:billingAccount[@id = /ns0:commercialOrderCns/ns0:order/ns0:mobile/ns0:servizioMobile/@idBAnrc]/@tipologiaCdf','xmlns:ns0="http://phoenix.wind.it/common/commercialOrderCns/cmfSchema.xsd"') tipologia_Cdf,
extractvalue((xmltype(doc.document_xml)),'ns0:commercialOrderCns/ns0:order/ns0:mobile//ns0:servizioMobile/ns0:tracciamentoNoTax/@azione','xmlns:ns0="http://phoenix.wind.it/common/commercialOrderCns/cmfSchema.xsd"') pre_no_tax,
extractvalue((xmltype(doc.document_xml)),'ns0:commercialOrderCns/ns0:order/ns0:mobile/ns0:esbAttributoGenerico[ns0:nome=''FLAG_IS_MOBILE_TIED_YN'']/ns0:valore','xmlns:ns0="http://phoenix.wind.it/common/commercialOrderCns/cmfSchema.xsd"') FLAG_IS_MOBILE_TIED_YN,
extractvalue((xmltype(doc.document_xml)),'ns0:commercialOrderCns/ns0:order/ns0:esbField[ns0:name=''CHANGE_TARIFF_PLAN_TYPE'']/ns0:valore','xmlns:ns0="http://phoenix.wind.it/common/commercialOrderCns/cmfSchema.xsd"') CHANGE_TARIFF_PLAN_TYPE,
extractvalue((xmltype(doc.document_xml)),'ns0:commercialOrderCns/ns0:order/ns0:esbField[ns0:name=''CHANGE_CLASS_TYPE'']/ns0:valore','xmlns:ns0="http://phoenix.wind.it/common/commercialOrderCns/cmfSchema.xsd"') CHANGE_CLASS_TYPE,
extractvalue((xmltype(doc.document_xml)),'ns0:commercialOrderCns/ns0:order/ns0:esbField[ns0:name=''FROM_TIED_TO_PRENOTAX'']/ns0:valore','xmlns:ns0="http://phoenix.wind.it/common/commercialOrderCns/cmfSchema.xsd"') FROM_TIED_TO_PRENOTAX,
extractvalue((xmltype(doc.document_xml)),'ns0:commercialOrderCns/ns0:order/ns0:esbField[ns0:name=''FROM_PRENOTAX_TO_PRENOTAX'']/ns0:valore','xmlns:ns0="http://phoenix.wind.it/common/commercialOrderCns/cmfSchema.xsd"') FROM_PRENOTAX_TO_PRENOTAX,
extractvalue((xmltype(doc.document_xml)),'ns0:commercialOrderCns/ns0:order/ns0:esbField[ns0:name=''FROM_STANDARD_TO_PRENOTAX'']/ns0:valore','xmlns:ns0="http://phoenix.wind.it/common/commercialOrderCns/cmfSchema.xsd"') FROM_STANDARD_TO_PRENOTAX,
extractvalue((xmltype(doc.document_xml)),'ns0:commercialOrderCns/ns0:order/ns0:esbField[ns0:name=''FROM_PRENOTAX_TO_STANDARD'']/ns0:valore','xmlns:ns0="http://phoenix.wind.it/common/commercialOrderCns/cmfSchema.xsd"') FROM_PRENOTAX_TO_STANDARD,
extractvalue((xmltype(doc.document_xml)),'ns0:commercialOrderCns/ns0:order/ns0:esbField[ns0:name=''FROM_TIED_TO_TIED'']/ns0:valore','xmlns:ns0="http://phoenix.wind.it/common/commercialOrderCns/cmfSchema.xsd"') FROM_TIED_TO_TIED,
extractvalue((xmltype(doc.document_xml)),'ns0:commercialOrderCns/ns0:order/ns0:esbField[ns0:name=''FROM_STANDARD_TO_TIED'']/ns0:valore','xmlns:ns0="http://phoenix.wind.it/common/commercialOrderCns/cmfSchema.xsd"') FROM_STANDARD_TO_TIED,
extractvalue((xmltype(doc.document_xml)),'ns0:commercialOrderCns/ns0:order/ns0:esbField[ns0:name=''FROM_TIED_TO_STANDARD'']/ns0:valore','xmlns:ns0="http://phoenix.wind.it/common/commercialOrderCns/cmfSchema.xsd"') FROM_TIED_TO_STANDARD,
extractvalue((xmltype(doc.document_xml)),'ns0:commercialOrderCns/ns0:order/ns0:esbField[ns0:name=''FROM_PRENOTAX_TO_TIED'']/ns0:valore','xmlns:ns0="http://phoenix.wind.it/common/commercialOrderCns/cmfSchema.xsd"') FROM_PRENOTAX_TO_TIED,
extractvalue((xmltype(doc.document_xml)),'ns0:commercialOrderCns/ns0:order/ns0:mobile/@flagCPE','xmlns:ns0="http://phoenix.wind.it/common/commercialOrderCns/cmfSchema.xsd"') flagCPE
from
request root,
request_doc doc,
request sdm
where
root.ts_created &gt;= to_date('29/04/2024 00:00:00','dd/mm/yyyy hh24:mi:ss') and
root.name = 'Change Order' and -- Switch Order (subentro),Change Order (cambi offerta) , Change Tariff Plan (cambi piano) ,Activation Order (att), Deactivation Order (cssz), Change Number (?cambio numero)
root.id = sdm.root_id and
sdm.name = 'Mobile Provisioning' and
sdm.status != 'AB' and
root.document_id = doc.id 
--and root.id=3455031415
)
where 1=1
and rownum&lt;3
--and flagCPE='Y'</code></pre></div><p></p><div class="section-column2"><table><thead><tr class="first-row"><th>ROOT_ID</th><th>ROOT_NAME</th><th>ROOT_TS_CREATED</th><th>ID_BA_NRC</th><th>ID_BA_NRC_OLD</th><th>ID_BA_RC</th><th>ID_BA_RC_OLD</th><th>ID_BA_USG</th><th>ID_BA_USG_OLD</th><th>TIPOLOGIA_CDF</th><th>PRE_NO_TAX</th><th>FLAG_IS_MOBILE_TIED_YN</th><th>CHANGE_TARIFF_PLAN_TYPE</th><th>CHANGE_CLASS_TYPE</th><th>FROM_TIED_TO_PRENOTAX</th><th>FROM_PRENOTAX_TO_PRENOTAX</th><th>FROM_STANDARD_TO_PRENOTAX</th><th>FROM_PRENOTAX_TO_STANDARD</th><th>FROM_TIED_TO_TIED</th><th>FROM_STANDARD_TO_TIED</th><th>FROM_TIED_TO_STANDARD</th><th>FROM_PRENOTAX_TO_TIED</th><th>FLAGCPE</th></tr></thead><tbody><tr><td>3508298362</td><td>Change Order</td><td>08/05/2024 01:08:05,223125</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td>STANDARD</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>3509403142</td><td>Change Order</td><td>09/05/2024 04:47:57,460907</td><td>P1117373630</td><td>P1117373630</td><td>P1117373630</td><td>P1117373630</td><td>P1117373630</td><td>P1117373630</td><td>Prepagato</td><td></td><td>Y</td><td>STANDARD</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td>N</td></tr></tbody></table></div><p></p></div></div><div class="chapter-container" id="ID1715260945345"><div class="chapter-title">QUERY DISCARD(ID1715260945345)</div><button class="chapter-button">Aggiungi Paragrafo</button><button class="chapter-button">Elimina Paragrafo</button><div class="section" id="ID1715260972237"><div class="section-column1"><div class="section-title">Estrazione dei dettagli della discard a partire dall'id ordine (ID1715260972237)</div><hr><pre><code class="language-sql">select de.*,DI.RECEIVER_NAME,DI.SYSTEM,DI.TS_DISCARD,DI.ID_DISCARD,
to_char(REGEXP_SUBSTR(error_msg, '(.*?)', 1, 1, NULL, 1)) AS error_message
from detail de, discard2detail dd, discard di
where di.id_discard = dd.id_discard
and dd.id_detail = de.id
and de.value like  
( '450%') and rownum&lt;3
order by ts_discard desc</code></pre></div><p></p><div class="section-column2"><table><thead><tr class="first-row"><th>ID</th><th>NAME</th><th>VALUE</th><th>POS</th><th>CFG_ID</th><th>ROOT_ID</th><th>RECEIVER_NAME</th><th>SYSTEM</th><th>TS_DISCARD</th><th>ID_DISCARD</th><th>ERROR_MESSAGE</th></tr></thead><tbody><tr><td>39946249968</td><td>transaction_id</td><td>4500017b-7b93-427a-98ac-fe329ff7b55f</td><td>0</td><td>2</td><td></td><td>bwRecDocumentCheck</td><td>cvp</td><td>31/01/2024 19:07:03,845000</td><td>261326070</td><td></td></tr><tr><td>37826199313</td><td>transaction_id</td><td>45000049-e8cf-4a2b-bc25-a28a2a39934b</td><td>0</td><td>2</td><td></td><td>bwRecDocumentCheck</td><td>cvp</td><td>26/04/2023 15:00:17,863000</td><td>254933143</td></tr></tbody></table></div><p></p></div><div class="section" id="ID1715261050684"><div class="section-column1"><div class="section-title">Estrazione dei dettagli della discard a partire dall'id ordine (ID1715261050684)</div><hr><pre><code class="language-sql">select de.*,di.*,
to_char(REGEXP_SUBSTR(error_msg, '(.*?)', 1, 1, NULL, 1)) AS error_message
from detail de, discard2detail dd, discard di
where di.id_discard = dd.id_discard
and dd.id_detail = de.id
and error_msg like ( '%4503329465%')
and di.ts_discard&gt;sysdate-1
order by ts_discard desc</code></pre></div><p></p><div class="section-column2"><table><thead><tr class="first-row"><th>n.a.</th></tr></thead><tbody></tbody></table></div><p></p></div><div class="section" id="ID1715261142133"><div class="section-column1"><div class="section-title">Estrazione dei dettagli della discard a partire dal like (ID1715261142133)</div><hr><pre><code class="language-sql">select * from discard where ts_discard&gt;sysdate-4 and error_msg  like ( '%4503329465%')and  rownum&lt;2</code></pre></div><p></p><div class="section-column2"><table><thead><tr class="first-row"><th>ID</th><th>NAME</th><th>VALUE</th><th>POS</th><th>CFG_ID</th><th>ROOT_ID</th><th>ID_DISCARD</th><th>RECEIVER_NAME</th><th>MESSAGE</th><th>ERROR_MSG</th><th>TS_DISCARD</th><th>SYSTEM</th><th>ERROR_MESSAGE</th></tr></thead><tbody><tr><td>40641664508</td><td>transaction_id</td><td>7437249</td><td>0</td><td>2</td><td></td><td>262462824</td><td>adapterReceiverOrdini</td><td>ERROR in SAP order result receiver: [25279384]</td></tr><tr><td>Meassage:</td></tr><tr><td>&lt;?xml version="1.0" encoding="UTF-8"?&gt;</td></tr><tr><td>&lt;ns:P__X__SAP__ESB__ORDINI xmlns:ae="http://www.tibco.com/xmlns/ae2xsd/2002/05" xmlns:ns="http://www.tibco.com/xmlns/ae2xsd/2002/05/ae/ADB/ActiveDatabaseAdapterConfigurationSAP" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="ns:P__X__SAP__ESB__ORDINI"&gt;</td></tr><tr><td>&lt;SEQUENCE&gt;7437249&lt;/SEQUENCE&gt;</td></tr><tr><td>&lt;ID__ORDINE__SAP&gt;25279384&lt;/ID__ORDINE__SAP&gt;</td></tr><tr><td>&lt;ID__CONSEGNA__SAP&gt;65088330&lt;/ID__CONSEGNA__SAP&gt;</td></tr><tr><td>&lt;DATA__ESITO&gt;</td></tr><tr><td>&lt;dateTime&gt;2024-04-29 14:53:22&lt;/dateTime&gt;</td></tr><tr><td>&lt;/DATA__ESITO&gt;</td></tr><tr><td>&lt;DESC__ERRORE xsi:nil="true"/&gt;</td></tr><tr><td>&lt;CAUSALE&gt;GIACENZA&lt;/CAUSALE&gt;</td></tr><tr><td>&lt;DESCRIZIONE__GIACENZA&gt;DESTINATARIO RISULTA SCONOSCIUTO ALL'INDIRIZZO&lt;/DESCRIZIONE__GIACENZA&gt;</td></tr><tr><td>&lt;DATA__GIACENZA&gt;</td></tr><tr><td>&lt;dateTime&gt;2024-04-29 15:30:17&lt;/dateTime&gt;</td></tr><tr><td>&lt;/DATA__GIACENZA&gt;</td></tr><tr><td>&lt;TIMESTAMP__CREATED__SAP&gt;</td></tr><tr><td>&lt;dateTime&gt;2024-04-29 15:30:17&lt;/dateTime&gt;</td></tr><tr><td>&lt;/TIMESTAMP__CREATED__SAP&gt;</td></tr><tr><td>&lt;PROCESSATO__ESB&gt;N&lt;/PROCESSATO__ESB&gt;</td></tr><tr><td>&lt;TIMESTAMP__ACQUISIZIONE__ESB xsi:nil="true"/&gt;</td></tr><tr><td>&lt;FLAG__REINTEGRO xsi:nil="true"/&gt;</td></tr><tr><td>&lt;ADB__SUBJECT xsi:nil="true"/&gt;</td></tr><tr><td>&lt;ADB__SEQUENCE&gt;7430587&lt;/ADB__SEQUENCE&gt;</td></tr><tr><td>&lt;ADB__TIMESTAMP&gt;2024-04-29 15:30:35&lt;/ADB__TIMESTAMP&gt;</td></tr><tr><td>&lt;ADB__OPCODE&gt;1&lt;/ADB__OPCODE&gt;</td></tr><tr><td>&lt;ADB__REF__OBJECT xsi:nil="true"/&gt;</td></tr><tr><td>&lt;ADB__AGENT__ID&gt;esb2sapAdp-esb2sapAdp&lt;/ADB__AGENT__ID&gt;</td></tr><tr><td>&lt;/ns:P__X__SAP__ESB__ORDINI&gt;</td></tr><tr><td></td><td>ERROR in SAP order result receiver: Request di logistica con Salesdocument iinviato non esistente, Result of CheckRequestSapIdLogistics : 0</td><td>09/05/2024 15:23:56,993000</td><td>sap</td><td></td></tr><tr><td>40641664513</td><td>sap_order_id</td><td>25279384</td><td>0</td><td>16</td><td></td><td>262462824</td><td>adapterReceiverOrdini</td><td>ERROR in SAP order result receiver: [25279384]</td></tr><tr><td>Meassage:</td></tr><tr><td>&lt;?xml version="1.0" encoding="UTF-8"?&gt;</td></tr><tr><td>&lt;ns:P__X__SAP__ESB__ORDINI xmlns:ae="http://www.tibco.com/xmlns/ae2xsd/2002/05" xmlns:ns="http://www.tibco.com/xmlns/ae2xsd/2002/05/ae/ADB/ActiveDatabaseAdapterConfigurationSAP" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="ns:P__X__SAP__ESB__ORDINI"&gt;</td></tr><tr><td>&lt;SEQUENCE&gt;7437249&lt;/SEQUENCE&gt;</td></tr><tr><td>&lt;ID__ORDINE__SAP&gt;25279384&lt;/ID__ORDINE__SAP&gt;</td></tr><tr><td>&lt;ID__CONSEGNA__SAP&gt;65088330&lt;/ID__CONSEGNA__SAP&gt;</td></tr><tr><td>&lt;DATA__ESITO&gt;</td></tr><tr><td>&lt;dateTime&gt;2024-04-29 14:53:22&lt;/dateTime&gt;</td></tr><tr><td>&lt;/DATA__ESITO&gt;</td></tr><tr><td>&lt;DESC__ERRORE xsi:nil="true"/&gt;</td></tr><tr><td>&lt;CAUSALE&gt;GIACENZA&lt;/CAUSALE&gt;</td></tr><tr><td>&lt;DESCRIZIONE__GIACENZA&gt;DESTINATARIO RISULTA SCONOSCIUTO ALL'INDIRIZZO&lt;/DESCRIZIONE__GIACENZA&gt;</td></tr><tr><td>&lt;DATA__GIACENZA&gt;</td></tr><tr><td>&lt;dateTime&gt;2024-04-29 15:30:17&lt;/dateTime&gt;</td></tr><tr><td>&lt;/DATA__GIACENZA&gt;</td></tr><tr><td>&lt;TIMESTAMP__CREATED__SAP&gt;</td></tr><tr><td>&lt;dateTime&gt;2024-04-29 15:30:17&lt;/dateTime&gt;</td></tr><tr><td>&lt;/TIMESTAMP__CREATED__SAP&gt;</td></tr><tr><td>&lt;PROCESSATO__ESB&gt;N&lt;/PROCESSATO__ESB&gt;</td></tr><tr><td>&lt;TIMESTAMP__ACQUISIZIONE__ESB xsi:nil="true"/&gt;</td></tr><tr><td>&lt;FLAG__REINTEGRO xsi:nil="true"/&gt;</td></tr><tr><td>&lt;ADB__SUBJECT xsi:nil="true"/&gt;</td></tr><tr><td>&lt;ADB__SEQUENCE&gt;7430587&lt;/ADB__SEQUENCE&gt;</td></tr><tr><td>&lt;ADB__TIMESTAMP&gt;2024-04-29 15:30:35&lt;/ADB__TIMESTAMP&gt;</td></tr><tr><td>&lt;ADB__OPCODE&gt;1&lt;/ADB__OPCODE&gt;</td></tr><tr><td>&lt;ADB__REF__OBJECT xsi:nil="true"/&gt;</td></tr><tr><td>&lt;ADB__AGENT__ID&gt;esb2sapAdp-esb2sapAdp&lt;/ADB__AGENT__ID&gt;</td></tr><tr><td>&lt;/ns:P__X__SAP__ESB__ORDINI&gt;</td></tr><tr><td></td><td>ERROR in SAP order result receiver: Request di logistica con Salesdocument iinviato non esistente, Result of CheckRequestSapIdLogistics : 0</td><td>09/05/2024 15:23:56,993000</td><td>sap</td></tr></tbody></table></div><p></p></div></div><div class="chapter-container" id="ID1715261192860"><div class="chapter-title">QUERY PER ESTRAZIONE OLI SU ESB(ID1715261192860)</div><button class="chapter-button">Aggiungi Paragrafo</button><button class="chapter-button">Elimina Paragrafo</button><div class="section" id="ID1715261248172"><div class="section-column1"><div class="section-title">Estrae OLI in maniera gerarchica a partire dall'ordine (query 1) (ID1715261248172)</div><hr><pre><code class="language-sql">select distinct
zz.req_ts_created,level livello,
DECODE (LEVEL,
                   1, zz.TIPO||'-'||zz.sottotipo,
                   2, '|__ ' || zz.TIPO||'-'||zz.sottotipo,
                   3, '    |__ ' || zz.TIPO||'-'||zz.sottotipo,
                   4, '       |__ ' || zz.TIPO||'-'||zz.sottotipo,
                   5, '          |__ ' || zz.TIPO||'-'||zz.sottotipo,
                   '             |__ ' || zz.TIPO||'-'||zz.sottotipo)
              tipo, 
zz.azione,
zz.sottoTipo,
zz.componentRoot,
zz.id,
zz.integrationid,
zz.idPrice,
zz.mdf,
zz.codicePs,
zz.descrizionePS,          
zz.componentpadre2,
zz.rcOverridePrice,
zz.transactionIdAsset,
zz.idCommercialOrder,
zz.tipo_ordine,
zz.sottotipo_ordine,
zz.causale_ordine,
zz.req_id,zz.req_status,zz.req_name,
zz.iccid,
zz.iccidOld,
zz.msisdn,
zz.msisdnOld
 from (
select 
r.id req_id,r.status req_status,r.name req_name,r.ts_created req_ts_created,
extractValue(xmltype(message_xml),'commercialOrder/order/@idCommercialOrder','xmlns="http://phoenix.wind.it/esb/CommercialOrder"')as idCommercialOrder,
extractValue(xmltype(message_xml),'commercialOrder/order/@tipo','xmlns="http://phoenix.wind.it/esb/CommercialOrder"')as tipo_ordine,
extractValue(xmltype(message_xml),'commercialOrder/order/@sottotipo','xmlns="http://phoenix.wind.it/esb/CommercialOrder"') as sottotipo_ordine,
extractValue(xmltype(message_xml),'commercialOrder/order/@causaleOrdine','xmlns="http://phoenix.wind.it/esb/CommercialOrder"') as causale_ordine,
case when p.tipo='PRD' then null else p.componentPadre end as componentpadre2 ,
p.*
from action r, request rr ,action_msg am
,XMLTable(xmlnamespaces( 
default 'http://phoenix.wind.it/esb/CommercialOrder' 
),
              'commercialOrder/order//lineItem'
              PASSING XMLTYPE(am.message_xml)
              COLUMNS
                azione VARCHAR2(50) PATH '@azione'
                ,integrationId VARCHAR2(50) PATH '@integrationId'
                ,componentRoot VARCHAR2(50) PATH '@componentRoot'
                ,componentPadre VARCHAR2(50) PATH '@componentPadre'
                ,descrizionePS VARCHAR2(50) PATH '@descrizionePS'
                ,mdf VARCHAR2(50) PATH '@mdf'
                ,idPrice VARCHAR2(50) PATH '@idPrice'
                ,id VARCHAR2(50) PATH '@id'
                ,tipo VARCHAR2(50) PATH '@tipo'
                 ,sottoTipo VARCHAR2(50) PATH '@sottoTipo'
                 ,codicePs VARCHAR2(50) PATH '@codicePs'
                 ,rcOverridePrice VARCHAR2(50) PATH '@rcOverridePrice'
                 ,transactionIdAsset VARCHAR2(50) PATH '@transactionIdAsset'
                 ,iccid  VARCHAR2(50) PATH 'nomeAttributo[contains(text(), "ICCID")]/@valore'
                 ,iccidOld  VARCHAR2(50) PATH 'nomeAttributo[contains(text(), "ICCID")]/@valorePrecedente'
                 ,msisdn  VARCHAR2(50) PATH 'nomeAttributo[contains(text(), "MSISDN")]/@valore'
                 ,msisdnOld  VARCHAR2(50) PATH 'nomeAttributo[contains(text(), "MSISDN")]/@valorePrecedente'
                ) p,
(SELECT a.name as act_name,a.request_id req_root_id
                               FROM action a, cfg_action b
                              WHERE a.request_id IN
                                       (SELECT DISTINCT root_id
                                          FROM detail
                                         WHERE VALUE IN (
--select id from tmp_ordini_com where stato ='dl'
'1-620834536596'
))
                                    AND b.id = a.cfg_id
                                    AND b.endpoint = 'queue.siebel.crp.om.in') cfg_det                
where 
r.name = cfg_det.act_name
and RR.ID=r.request_id
and am.id=r.message_id
and rr.root_id =  cfg_det.req_root_id 
) zz  
START WITH 
zz.componentPadre2 is null 
CONNECT BY PRIOR  zz.integrationid=zz.componentPadre2
order by integrationId, idCommercialOrder,level</code></pre></div><p></p><div class="section-column2"><table><thead><tr class="first-row"><th>REQ_TS_CREATED</th><th>LIVELLO</th><th>TIPO</th><th>AZIONE</th><th>SOTTOTIPO</th><th>COMPONENTROOT</th><th>ID</th><th>INTEGRATIONID</th><th>IDPRICE</th><th>MDF</th><th>CODICEPS</th><th>DESCRIZIONEPS</th><th>COMPONENTPADRE2</th><th>RCOVERRIDEPRICE</th><th>TRANSACTIONIDASSET</th><th>IDCOMMERCIALORDER</th><th>TIPO_ORDINE</th><th>SOTTOTIPO_ORDINE</th><th>CAUSALE_ORDINE</th><th>REQ_ID</th><th>REQ_STATUS</th><th>REQ_NAME</th><th>ICCID</th><th>ICCIDOLD</th><th>MSISDN</th><th>MSISDNOLD</th></tr></thead><tbody><tr><td>09/04/2024 10:15:19,960825</td><td>1</td><td>PRD-WLESSPREPAG</td><td>Modify</td><td>WLESSPREPAG</td><td>1607664817064</td><td>1-7X9CPQVJ</td><td>1607664817064</td><td></td><td>PRENOTAX</td><td>PHX00032</td><td>Mobile Ricaricabile</td><td></td><td></td><td></td><td>1-620834536596</td><td>Modifica</td><td>Modifica Commerciale</td><td>Variazione Commerciale</td><td>69552616485</td><td>SA</td><td>Receive Commercial/Technical Change</td><td></td><td></td><td></td><td></td></tr><tr><td>09/04/2024 10:15:19,960825</td><td>2</td><td>|__ TC-ACCPREPMOB</td><td>-</td><td>ACCPREPMOB</td><td>1607664817064</td><td>1-7X9CPQVL</td><td>1607664817066</td><td></td><td>PRENOTAX</td><td>PHX00033</td><td>Accesso Mobile Ricaricabile</td><td>1607664817064</td><td></td><td>2000000000000000000000014313025</td><td>1-620834536596</td><td>Modifica</td><td>Modifica Commerciale</td><td>Variazione Commerciale</td><td>69552616485</td><td>SA</td><td>Receive Commercial/Technical Change</td><td>8939998030011451822</td><td>8939998030011451822</td><td></td><td></td></tr><tr><td>09/04/2024 10:15:19,960825</td><td>2</td><td>|__ TC-SRVPREPMOB</td><td>Modify</td><td>SRVPREPMOB</td><td>1607664817064</td><td>1-7X9CPQW2</td><td>1607664817083</td><td></td><td>PRENOTAX</td><td>PHX00034</td><td>Servizio Mobile Ricaricabile</td><td>1607664817064</td><td></td><td>2000000000000000000000014313033</td><td>1-620834536596</td><td>Modifica</td><td>Modifica Commerciale</td><td>Variazione Commerciale</td><td>69552616485</td><td>SA</td><td>Receive Commercial/Technical Change</td><td></td><td></td><td>3919197280</td><td>3919197280</td></tr><tr><td>09/04/2024 10:15:19,960825</td><td>3</td><td>|__ TE-SROMINT</td><td>-</td><td>SROMINT</td><td>1607664817064</td><td>1-7X9CPQWD</td><td>1607664817090</td><td></td><td>PRENOTAX</td><td>PHX00039</td><td>Servizio Roaming Internazionale</td><td>1607664817083</td><td></td><td>2000000000000000000000014313063</td><td>1-620834536596</td><td>Modifica</td><td>Modifica Commerciale</td><td>Variazione Commerciale</td><td>69552616485</td><td>SA</td><td>Receive Commercial/Technical Change</td><td></td><td></td><td></td><td></td></tr><tr><td>09/04/2024 10:15:19,960825</td><td>3</td><td>|__ TE-SCHMINT</td><td>-</td><td>SCHMINT</td><td>1607664817064</td><td>1-7X9CPQWH</td><td>1607664817091</td><td></td><td>PRENOTAX</td><td>PHX00040</td><td>Servizio Chiamate Internazionali</td><td>1607664817083</td><td></td><td>2000000000000000000000014313071</td><td>1-620834536596</td><td>Modifica</td><td>Modifica Commerciale</td><td>Variazione Commerciale</td><td>69552616485</td><td>SA</td><td>Receive Commercial/Technical Change</td><td></td><td></td><td></td><td></td></tr><tr><td>09/04/2024 10:15:19,960825</td><td>3</td><td>|__ TE-SSGRTEL</td><td>-</td><td>SSGRTEL</td><td>1607664817064</td><td>1-7X9CPQW9</td><td>1607664817092</td><td></td><td>PRENOTAX</td><td>PHX00041</td><td>Servizio Segreteria Telefonica</td><td>1607664817083</td><td></td><td>2000000000000000000000014313039</td><td>1-620834536596</td><td>Modifica</td><td>Modifica Commerciale</td><td>Variazione Commerciale</td><td>69552616485</td><td>SA</td><td>Receive Commercial/Technical Change</td><td></td><td></td><td></td><td></td></tr><tr><td>09/04/2024 10:15:19,960825</td><td>3</td><td>|__ TE-SSMSORG</td><td>-</td><td>SSMSORG</td><td>1607664817064</td><td>1-7X9CPQWE</td><td>1607664817095</td><td></td><td>PRENOTAX</td><td>PHX00042</td><td>Servizio SMS Originati</td><td>1607664817083</td><td></td><td>2000000000000000000000014313047</td><td>1-620834536596</td><td>Modifica</td><td>Modifica Commerciale</td><td>Variazione Commerciale</td><td>69552616485</td><td>SA</td><td>Receive Commercial/Technical Change</td><td></td><td></td><td></td><td></td></tr><tr><td>09/04/2024 10:15:19,960825</td><td>3</td><td>|__ TE-INTWAPBIZ</td><td>-</td><td>INTWAPBIZ</td><td>1607664817064</td><td>1-7X9CPQWG</td><td>1607664817096</td><td></td><td>PRENOTAX</td><td>PHX30014</td><td>Internet BIZ/Wap BIZ</td><td>1607664817083</td><td></td><td>2000000000000000000000014313055</td><td>1-620834536596</td><td>Modifica</td><td>Modifica Commerciale</td><td>Variazione Commerciale</td><td>69552616485</td><td>SA</td><td>Receive Commercial/Technical Change</td><td></td><td></td><td></td><td></td></tr><tr><td>09/04/2024 10:15:19,960825</td><td>3</td><td>|__ TE-LTE</td><td>-</td><td>LTE</td><td>1607664817064</td><td>1-7X9CPQWC</td><td>1607666265668</td><td></td><td></td><td>PHX50805</td><td>Servizio LTE</td><td>1607664817083</td><td></td><td>2000000000000000000000014313079</td><td>1-620834536596</td><td>Modifica</td><td>Modifica Commerciale</td><td>Variazione Commerciale</td><td>69552616485</td><td>SA</td><td>Receive Commercial/Technical Change</td><td></td><td></td><td></td><td></td></tr><tr><td>09/04/2024 10:15:19,960825</td><td>3</td><td>|__ TE-5GPRE</td><td>-</td><td>5GPRE</td><td>1607664817064</td><td>1-7X9CPQWF</td><td>1607666265727</td><td></td><td></td><td>PHX70278</td><td>Opzione 5G Ricaricabile</td><td>1607664817083</td><td></td><td>2000000000000000000000014313179</td><td>1-620834536596</td><td>Modifica</td><td>Modifica Commerciale</td><td>Variazione Commerciale</td><td>69552616485</td><td>SA</td><td>Receive Commercial/Technical Change</td><td></td><td></td><td></td><td></td></tr><tr><td>09/04/2024 10:15:19,960825</td><td>3</td><td>|__ TE-VLTE</td><td>-</td><td>VLTE</td><td>1607664817064</td><td>1-7X9CPQWJ</td><td>1610183024110</td><td></td><td></td><td>PHX70280</td><td>Servizi VoLTE e VoWiFi</td><td>1607664817083</td><td></td><td>2000000000000000000000017647180</td><td>1-620834536596</td><td>Modifica</td><td>Modifica Commerciale</td><td>Variazione Commerciale</td><td>69552616485</td><td>SA</td><td>Receive Commercial/Technical Change</td><td></td><td></td><td></td><td></td></tr><tr><td>09/04/2024 10:15:19,960825</td><td>3</td><td>|__ TE-MMS</td><td>-</td><td>MMS</td><td>1607664817064</td><td>1-7X9CPQWI</td><td>1611701585725</td><td></td><td></td><td>PHX30017</td><td>MMS</td><td>1607664817083</td><td></td><td>2000000000000000000000019271448</td><td>1-620834536596</td><td>Modifica</td><td>Modifica Commerciale</td><td>Variazione Commerciale</td><td>69552616485</td><td>SA</td><td>Receive Commercial/Technical Change</td><td></td><td></td><td></td><td></td></tr><tr><td>09/04/2024 10:15:19,960825</td><td>3</td><td>|__ PC-PNTF</td><td>-</td><td>PNTF</td><td>1607664817064</td><td>1-7X9CPQWN</td><td>1616327921800</td><td></td><td>PRENOTAX</td><td>PHX00087</td><td>All Inclusive Aziende Ricaricabile Unlimited</td><td>1607664817083</td><td></td><td>2000000000000000000000116575993</td><td>1-620834536596</td><td>Modifica</td><td>Modifica Commerciale</td><td>Variazione Commerciale</td><td>69552616485</td><td>SA</td><td>Receive Commercial/Technical Change</td><td></td><td></td><td></td><td></td></tr><tr><td>09/04/2024 10:15:19,960825</td><td>3</td><td>|__ PC-OPZ</td><td>Remove</td><td>OPZ</td><td>1607664817064</td><td>1-7X9CPQWM</td><td>1616327921801</td><td></td><td>PRENOTAX</td><td>PHX00167</td><td>Opz Internet Top Ricaricabile</td><td>1607664817083</td><td></td><td></td><td>1-620834536596</td><td>Modifica</td><td>Modifica Commerciale</td><td>Variazione Commerciale</td><td>69552616485</td><td>SA</td><td>Receive Commercial/Technical Change</td><td></td><td></td><td></td><td></td></tr><tr><td>09/04/2024 10:15:19,960825</td><td>3</td><td>|__ PC-OPZ</td><td>-</td><td>OPZ</td><td>1607664817064</td><td>1-7X9CPQWK</td><td>1620795195702</td><td></td><td>PRENOTAX</td><td>PHX00092</td><td>All Inclusive Travel Europa&amp;USA Aziende Ricaricabi</td><td>1607664817083</td><td></td><td>2000000000000000000000545173719</td><td>1-620834536596</td><td>Modifica</td><td>Modifica Commerciale</td><td>Variazione Commerciale</td><td>69552616485</td><td>SA</td><td>Receive Commercial/Technical Change</td><td></td><td></td><td></td><td></td></tr><tr><td>09/04/2024 10:15:19,960825</td><td>3</td><td>|__ PC-OPZ</td><td>-</td><td>OPZ</td><td>1607664817064</td><td>1-7X9CPQWL</td><td>1620795195703</td><td></td><td>PRENOTAX</td><td>PHX00101</td><td>All Inclusive Mondo Aziende Ricaricabile</td><td>1607664817083</td><td></td><td>2000000000000000000000545173737</td><td>1-620834536596</td><td>Modifica</td><td>Modifica Commerciale</td><td>Variazione Commerciale</td><td>69552616485</td><td>SA</td><td>Receive Commercial/Technical Change</td></tr></tbody></table></div><p></p></div><div class="section" id="ID1715261307256"><div class="section-column1"><div class="section-title">Estrae OLI in maniera gerarchica a partire dall'ordine (query 2) - storico (ID1715261307256)</div><hr><pre><code class="language-sql">select 
zz.req_ts_created,
DECODE (LEVEL,
                   1, zz.TIPO||'-'||zz.sottotipo,
                   2, '|__ ' || zz.TIPO||'-'||zz.sottotipo,
                   3, '    |__ ' || zz.TIPO||'-'||zz.sottotipo,
                   4, '       |__ ' || zz.TIPO||'-'||zz.sottotipo,
                   5, '          |__ ' || zz.TIPO||'-'||zz.sottotipo,
                   '             |__ ' || zz.TIPO||'-'||zz.sottotipo)
              tipo, 
zz.azione,
zz.sottoTipo,
zz.componentRoot,
zz.id,
zz.integrationid,
zz.idPrice,
zz.mdf,
zz.codicePs,
zz.descrizionePS,          
zz.componentpadre2,
zz.rcOverridePrice,
zz.idCommercialOrder,
zz.tipo_ordine,
zz.sottotipo_ordine,
zz.causale_ordine,
zz.req_id,zz.req_status,zz.req_name from (
select 
r.id req_id,r.status req_status,r.name req_name,r.ts_created req_ts_created,
extractValue(xmltype(message_xml),'commercialOrder/order/@idCommercialOrder','xmlns="http://phoenix.wind.it/esb/CommercialOrder"')as idCommercialOrder,
extractValue(xmltype(message_xml),'commercialOrder/order/@tipo','xmlns="http://phoenix.wind.it/esb/CommercialOrder"')as tipo_ordine,
extractValue(xmltype(message_xml),'commercialOrder/order/@sottotipo','xmlns="http://phoenix.wind.it/esb/CommercialOrder"') as sottotipo_ordine,
extractValue(xmltype(message_xml),'commercialOrder/order/@causaleOrdine','xmlns="http://phoenix.wind.it/esb/CommercialOrder"') as causale_ordine,
case when p.tipo='PRD' then null else p.componentPadre end as componentpadre2 ,
p.*
from action_hs r, request_hs rr ,action_msg_hs am
,XMLTable(xmlnamespaces( 
default 'http://phoenix.wind.it/esb/CommercialOrder' 
),
              'commercialOrder/order//lineItem'
              PASSING XMLTYPE(am.message_xml)
              COLUMNS
                azione VARCHAR2(50) PATH '@azione'
                ,integrationId VARCHAR2(50) PATH '@integrationId'
                ,componentRoot VARCHAR2(50) PATH '@componentRoot'
                ,componentPadre VARCHAR2(50) PATH '@componentPadre'
                ,descrizionePS VARCHAR2(50) PATH '@descrizionePS'
                ,mdf VARCHAR2(50) PATH '@mdf'
                ,idPrice VARCHAR2(50) PATH '@idPrice'
                ,id VARCHAR2(50) PATH '@id'
                ,tipo VARCHAR2(50) PATH '@tipo'
                 ,sottoTipo VARCHAR2(50) PATH '@sottoTipo'
                 ,codicePs VARCHAR2(50) PATH '@codicePs'
                 ,rcOverridePrice VARCHAR2(50) PATH '@rcOverridePrice'
                ) p           
where 
r.name = 'Receive Activation Order'
and RR.ID=r.request_id
and am.id=r.message_id
and rr.root_id in 
 (SELECT DISTINCT root_id
                                          FROM detail_hs
                                         WHERE VALUE IN (
                                             --   '1-619650892429', --INC7181401 roberti problema legato alla chiamata della procedura dei cpe su siebel e assenza del cdf =&gt; indirizzatoa crm 
'1-605924592287'
)
) 
) zz  
START WITH 
zz.componentPadre2 is null 
CONNECT BY PRIOR  zz.integrationid=zz.componentPadre2
--order by idcommercialorder,level</code></pre></div><p></p><div class="section-column2"><table><thead><tr class="first-row"><th>REQ_TS_CREATED</th><th>LIVELLO</th><th>TIPO</th><th>AZIONE</th><th>SOTTOTIPO</th><th>COMPONENTROOT</th><th>ID</th><th>INTEGRATIONID</th><th>IDPRICE</th><th>MDF</th><th>CODICEPS</th><th>DESCRIZIONEPS</th><th>COMPONENTPADRE2</th><th>RCOVERRIDEPRICE</th><th>TRANSACTIONIDASSET</th><th>IDCOMMERCIALORDER</th><th>TIPO_ORDINE</th><th>SOTTOTIPO_ORDINE</th><th>CAUSALE_ORDINE</th><th>REQ_ID</th><th>REQ_STATUS</th><th>REQ_NAME</th><th>ICCID</th><th>ICCIDOLD</th><th>MSISDN</th><th>MSISDNOLD</th></tr></thead><tbody><tr><td>09/04/2024 10:15:19,960825</td><td>1</td><td>PRD-WLESSPREPAG</td><td>Modify</td><td>WLESSPREPAG</td><td>1607664817064</td><td>1-7X9CPQVJ</td><td>1607664817064</td><td></td><td>PRENOTAX</td><td>PHX00032</td><td>Mobile Ricaricabile</td><td></td><td></td><td></td><td>1-620834536596</td><td>Modifica</td><td>Modifica Commerciale</td><td>Variazione Commerciale</td><td>69552616485</td><td>SA</td><td>Receive Commercial/Technical Change</td><td></td><td></td><td></td><td></td></tr><tr><td>09/04/2024 10:15:19,960825</td><td>2</td><td>|__ TC-ACCPREPMOB</td><td>-</td><td>ACCPREPMOB</td><td>1607664817064</td><td>1-7X9CPQVL</td><td>1607664817066</td><td></td><td>PRENOTAX</td><td>PHX00033</td><td>Accesso Mobile Ricaricabile</td><td>1607664817064</td><td></td><td>2000000000000000000000014313025</td><td>1-620834536596</td><td>Modifica</td><td>Modifica Commerciale</td><td>Variazione Commerciale</td><td>69552616485</td><td>SA</td><td>Receive Commercial/Technical Change</td><td>8939998030011451822</td><td>8939998030011451822</td><td></td><td></td></tr><tr><td>09/04/2024 10:15:19,960825</td><td>2</td><td>|__ TC-SRVPREPMOB</td><td>Modify</td><td>SRVPREPMOB</td><td>1607664817064</td><td>1-7X9CPQW2</td><td>1607664817083</td><td></td><td>PRENOTAX</td><td>PHX00034</td><td>Servizio Mobile Ricaricabile</td><td>1607664817064</td><td></td><td>2000000000000000000000014313033</td><td>1-620834536596</td><td>Modifica</td><td>Modifica Commerciale</td><td>Variazione Commerciale</td><td>69552616485</td><td>SA</td><td>Receive Commercial/Technical Change</td><td></td><td></td><td>3919197280</td><td>3919197280</td></tr><tr><td>09/04/2024 10:15:19,960825</td><td>3</td><td>|__ TE-SROMINT</td><td>-</td><td>SROMINT</td><td>1607664817064</td><td>1-7X9CPQWD</td><td>1607664817090</td><td></td><td>PRENOTAX</td><td>PHX00039</td><td>Servizio Roaming Internazionale</td><td>1607664817083</td><td></td><td>2000000000000000000000014313063</td><td>1-620834536596</td><td>Modifica</td><td>Modifica Commerciale</td><td>Variazione Commerciale</td><td>69552616485</td><td>SA</td><td>Receive Commercial/Technical Change</td><td></td><td></td><td></td><td></td></tr><tr><td>09/04/2024 10:15:19,960825</td><td>3</td><td>|__ TE-SCHMINT</td><td>-</td><td>SCHMINT</td><td>1607664817064</td><td>1-7X9CPQWH</td><td>1607664817091</td><td></td><td>PRENOTAX</td><td>PHX00040</td><td>Servizio Chiamate Internazionali</td><td>1607664817083</td><td></td><td>2000000000000000000000014313071</td><td>1-620834536596</td><td>Modifica</td><td>Modifica Commerciale</td><td>Variazione Commerciale</td><td>69552616485</td><td>SA</td><td>Receive Commercial/Technical Change</td><td></td><td></td><td></td><td></td></tr><tr><td>09/04/2024 10:15:19,960825</td><td>3</td><td>|__ TE-SSGRTEL</td><td>-</td><td>SSGRTEL</td><td>1607664817064</td><td>1-7X9CPQW9</td><td>1607664817092</td><td></td><td>PRENOTAX</td><td>PHX00041</td><td>Servizio Segreteria Telefonica</td><td>1607664817083</td><td></td><td>2000000000000000000000014313039</td><td>1-620834536596</td><td>Modifica</td><td>Modifica Commerciale</td><td>Variazione Commerciale</td><td>69552616485</td><td>SA</td><td>Receive Commercial/Technical Change</td><td></td><td></td><td></td><td></td></tr><tr><td>09/04/2024 10:15:19,960825</td><td>3</td><td>|__ TE-SSMSORG</td><td>-</td><td>SSMSORG</td><td>1607664817064</td><td>1-7X9CPQWE</td><td>1607664817095</td><td></td><td>PRENOTAX</td><td>PHX00042</td><td>Servizio SMS Originati</td><td>1607664817083</td><td></td><td>2000000000000000000000014313047</td><td>1-620834536596</td><td>Modifica</td><td>Modifica Commerciale</td><td>Variazione Commerciale</td><td>69552616485</td><td>SA</td><td>Receive Commercial/Technical Change</td><td></td><td></td><td></td><td></td></tr><tr><td>09/04/2024 10:15:19,960825</td><td>3</td><td>|__ TE-INTWAPBIZ</td><td>-</td><td>INTWAPBIZ</td><td>1607664817064</td><td>1-7X9CPQWG</td><td>1607664817096</td><td></td><td>PRENOTAX</td><td>PHX30014</td><td>Internet BIZ/Wap BIZ</td><td>1607664817083</td><td></td><td>2000000000000000000000014313055</td><td>1-620834536596</td><td>Modifica</td><td>Modifica Commerciale</td><td>Variazione Commerciale</td><td>69552616485</td><td>SA</td><td>Receive Commercial/Technical Change</td><td></td><td></td><td></td><td></td></tr><tr><td>09/04/2024 10:15:19,960825</td><td>3</td><td>|__ TE-LTE</td><td>-</td><td>LTE</td><td>1607664817064</td><td>1-7X9CPQWC</td><td>1607666265668</td><td></td><td></td><td>PHX50805</td><td>Servizio LTE</td><td>1607664817083</td><td></td><td>2000000000000000000000014313079</td><td>1-620834536596</td><td>Modifica</td><td>Modifica Commerciale</td><td>Variazione Commerciale</td><td>69552616485</td><td>SA</td><td>Receive Commercial/Technical Change</td><td></td><td></td><td></td><td></td></tr><tr><td>09/04/2024 10:15:19,960825</td><td>3</td><td>|__ TE-5GPRE</td><td>-</td><td>5GPRE</td><td>1607664817064</td><td>1-7X9CPQWF</td><td>1607666265727</td><td></td><td></td><td>PHX70278</td><td>Opzione 5G Ricaricabile</td><td>1607664817083</td><td></td><td>2000000000000000000000014313179</td><td>1-620834536596</td><td>Modifica</td><td>Modifica Commerciale</td><td>Variazione Commerciale</td><td>69552616485</td><td>SA</td><td>Receive Commercial/Technical Change</td><td></td><td></td><td></td><td></td></tr><tr><td>09/04/2024 10:15:19,960825</td><td>3</td><td>|__ TE-VLTE</td><td>-</td><td>VLTE</td><td>1607664817064</td><td>1-7X9CPQWJ</td><td>1610183024110</td><td></td><td></td><td>PHX70280</td><td>Servizi VoLTE e VoWiFi</td><td>1607664817083</td><td></td><td>2000000000000000000000017647180</td><td>1-620834536596</td><td>Modifica</td><td>Modifica Commerciale</td><td>Variazione Commerciale</td><td>69552616485</td><td>SA</td><td>Receive Commercial/Technical Change</td><td></td><td></td><td></td><td></td></tr><tr><td>09/04/2024 10:15:19,960825</td><td>3</td><td>|__ TE-MMS</td><td>-</td><td>MMS</td><td>1607664817064</td><td>1-7X9CPQWI</td><td>1611701585725</td><td></td><td></td><td>PHX30017</td><td>MMS</td><td>1607664817083</td><td></td><td>2000000000000000000000019271448</td><td>1-620834536596</td><td>Modifica</td><td>Modifica Commerciale</td><td>Variazione Commerciale</td><td>69552616485</td><td>SA</td><td>Receive Commercial/Technical Change</td><td></td><td></td><td></td><td></td></tr><tr><td>09/04/2024 10:15:19,960825</td><td>3</td><td>|__ PC-PNTF</td><td>-</td><td>PNTF</td><td>1607664817064</td><td>1-7X9CPQWN</td><td>1616327921800</td><td></td><td>PRENOTAX</td><td>PHX00087</td><td>All Inclusive Aziende Ricaricabile Unlimited</td><td>1607664817083</td><td></td><td>2000000000000000000000116575993</td><td>1-620834536596</td><td>Modifica</td><td>Modifica Commerciale</td><td>Variazione Commerciale</td><td>69552616485</td><td>SA</td><td>Receive Commercial/Technical Change</td><td></td><td></td><td></td><td></td></tr><tr><td>09/04/2024 10:15:19,960825</td><td>3</td><td>|__ PC-OPZ</td><td>Remove</td><td>OPZ</td><td>1607664817064</td><td>1-7X9CPQWM</td><td>1616327921801</td><td></td><td>PRENOTAX</td><td>PHX00167</td><td>Opz Internet Top Ricaricabile</td><td>1607664817083</td><td></td><td></td><td>1-620834536596</td><td>Modifica</td><td>Modifica Commerciale</td><td>Variazione Commerciale</td><td>69552616485</td><td>SA</td><td>Receive Commercial/Technical Change</td><td></td><td></td><td></td><td></td></tr><tr><td>09/04/2024 10:15:19,960825</td><td>3</td><td>|__ PC-OPZ</td><td>-</td><td>OPZ</td><td>1607664817064</td><td>1-7X9CPQWK</td><td>1620795195702</td><td></td><td>PRENOTAX</td><td>PHX00092</td><td>All Inclusive Travel Europa&amp;USA Aziende Ricaricabi</td><td>1607664817083</td><td></td><td>2000000000000000000000545173719</td><td>1-620834536596</td><td>Modifica</td><td>Modifica Commerciale</td><td>Variazione Commerciale</td><td>69552616485</td><td>SA</td><td>Receive Commercial/Technical Change</td><td></td><td></td><td></td><td></td></tr><tr><td>09/04/2024 10:15:19,960825</td><td>3</td><td>|__ PC-OPZ</td><td>-</td><td>OPZ</td><td>1607664817064</td><td>1-7X9CPQWL</td><td>1620795195703</td><td></td><td>PRENOTAX</td><td>PHX00101</td><td>All Inclusive Mondo Aziende Ricaricabile</td><td>1607664817083</td><td></td><td>2000000000000000000000545173737</td><td>1-620834536596</td><td>Modifica</td><td>Modifica Commerciale</td><td>Variazione Commerciale</td><td>69552616485</td><td>SA</td><td>Receive Commercial/Technical Change</td></tr></tbody></table></div><p></p></div></div><div class="chapter-container" id="ID1715261350759"><div class="chapter-title">QUERY PER ESTRAZIONE OGGETTI PROPAGATI AL BILLING(ID1715261350759)</div><button class="chapter-button">Aggiungi Paragrafo</button><button class="chapter-button">Elimina Paragrafo</button><div class="section" id="ID1715261748807"><div class="section-column1"><div class="section-title">Estrazione campi dall'emf verso combilling (ID1715261748807)</div><hr><pre><code class="language-sql">SELECT  a.id,
a.status,
a.name as act_name,
a.request_id req_root_id,
p.*
,extractValue(xmltype(d.message_xml),'/ns0:activateServiceIstance/ns0:serviceIstance/ns0:numeroTelefono','xmlns:ns0="http://billing.wind.it/esb/OrderManagement"')as numeroTelefono
,extractValue(xmltype(d.message_xml),'/ns0:activateServiceIstance/ns0:serviceIstance/ns0:extIdSI','xmlns:ns0="http://billing.wind.it/esb/OrderManagement"')as extIdSI
FROM action a, request c,action_msg d,
XMLTable(xmlnamespaces( 
default 'http://billing.wind.it/esb/OrderManagement' 
),
              '/activateServiceIstance/serviceIstance//billingElement'
              PASSING XMLTYPE(d.message_xml)
              COLUMNS
                extIdBE VARCHAR2(50) PATH 'extIdBE'
                ,idBE VARCHAR2(50) PATH 'idBE'
                ,idPrice VARCHAR2(50) PATH 'idPrice'
                ,mdf VARCHAR2(50) PATH 'mdf'
                ,idOrdine VARCHAR2(50) PATH 'idOrdine'
                ) p           
                WHERE 
                              c.id=a.request_id and
                              c.root_id IN
                                       (SELECT DISTINCT root_id
                                          FROM detail
                                         WHERE VALUE IN (
                                                 '1-619650892429'                                        )
        ) and a.system='kenan' and a.direction='outbound' and
        d.id=a.message_id</code></pre></div><p></p><div class="section-column2"><table><thead><tr class="first-row"><th>ID</th><th>STATUS</th><th>ACT_NAME</th><th>REQ_ROOT_ID</th><th>EXTIDBE</th><th>IDBE</th><th>IDPRICE</th><th>MDF</th><th>IDORDINE</th><th>NUMEROTELEFONO</th><th>EXTIDSI</th></tr></thead><tbody><tr><td>69822772372</td><td>SA</td><td>Active Service Instance</td><td>3493663849</td><td>1622523827378</td><td>336002</td><td></td><td></td><td>1-622523567036</td><td>i03909113</td><td>1622523827351</td></tr><tr><td>69822772372</td><td>SA</td><td>Active Service Instance</td><td>3493663849</td><td>1622523827387</td><td>332550</td><td></td><td></td><td>1-622523567036</td><td>i03909113</td><td>1622523827351</td></tr><tr><td>69822772372</td><td>SA</td><td>Active Service Instance</td><td>3493663849</td><td>1622523827396</td><td>334262</td><td></td><td></td><td>1-622523567036</td><td>i03909113</td><td>1622523827351</td></tr><tr><td>69822772372</td><td>SA</td><td>Active Service Instance</td><td>3493663849</td><td>1622523827405</td><td>334292</td><td></td><td></td><td>1-622523567036</td><td>i03909113</td><td>1622523827351</td></tr><tr><td>69822772372</td><td>SA</td><td>Active Service Instance</td><td>3493663849</td><td>1622523827414</td><td>331269</td><td></td><td></td><td>1-622523567036</td><td>i03909113</td><td>1622523827351</td></tr><tr><td>69822772372</td><td>SA</td><td>Active Service Instance</td><td>3493663849</td><td>1622523926587</td><td>335869</td><td></td><td></td><td>1-622523567036</td><td>i03909113</td><td>1622523827351</td></tr><tr><td>69822772372</td><td>SA</td><td>Active Service Instance</td><td>3493663849</td><td>1622523926596</td><td>336077</td><td></td><td></td><td>1-622523567036</td><td>i03909113</td><td>1622523827351</td></tr><tr><td>69822772372</td><td>SA</td><td>Active Service Instance</td><td>3493663849</td><td>1622523926605</td><td>334304</td><td></td><td></td><td>1-622523567036</td><td>i03909113</td><td>1622523827351</td></tr><tr><td>69822772372</td><td>SA</td><td>Active Service Instance</td><td>3493663849</td><td>1622523926614</td><td>334301</td><td></td><td></td><td>1-622523567036</td><td>i03909113</td><td>1622523827351</td></tr><tr><td>69822772372</td><td>SA</td><td>Active Service Instance</td><td>3493663849</td><td>1622523827423</td><td>334620</td><td></td><td></td><td>1-622523567036</td><td>i03909113</td><td>1622523827351</td></tr><tr><td>69822772372</td><td>SA</td><td>Active Service Instance</td><td>3493663849</td><td>1622523827437</td><td>335920</td><td></td><td></td><td>1-622523567036</td><td>i03909113</td><td>1622523827351</td></tr><tr><td>69822728869</td><td>SA</td><td>Active Equipment Service Instance</td><td>3493663849</td><td>1622523827589</td><td>332525</td><td></td><td></td><td>1-622523567036</td><td>A21622523827573</td><td>1622523827573</td></tr><tr><td>69815831858</td><td>SA</td><td>Active Service Instance</td><td>3493663849</td><td>1622523827464</td><td>334268</td><td></td><td></td><td>1-622523567036</td><td>0586325585</td><td>1622523827442</td></tr><tr><td>69822750310</td><td>SA</td><td>Active Equipment Service Instance</td><td>3493663849</td><td>1622523827610</td><td>332525</td><td></td><td></td><td>1-622523567036</td><td>A21622523827594</td><td>1622523827594</td></tr></tbody></table></div><p></p></div></div><div class="chapter-container" id="ID1715261766624"><div class="chapter-title">ESTRAZIONE MEDIANTE REGULAR EXPRESSION(ID1715261766624)</div><button class="chapter-button">Aggiungi Paragrafo</button><button class="chapter-button">Elimina Paragrafo</button><div class="section" id="ID1715261793757"><div class="section-column1"><div class="section-title">Estrazione di un campo dell'action message non ricorsivo (ID1715261793757)</div><hr><pre><code class="language-sql">select a.id,a.name,
        (select to_char(REGEXP_SUBSTR(zz.message_xml, '(.*?)', 1, 1, NULL, 1)) 
            from action z,action_msg zz 
                where z.name='Receive mobile provisioning result KO' 
                and z.request_id=a.request_id 
                and zz.id=z.message_id 
                and z.id=(select max(id) from action x where x.name='Receive mobile provisioning result KO' and x.request_id=a.request_id) 
         ) descr
        from action a where id in
        (
        66078832342,
66073801202)</code></pre></div><p></p><div class="section-column2"><table><thead><tr class="first-row"><th>ID</th><th>NAME</th><th>DESCR</th></tr></thead><tbody><tr><td>66073801202</td><td>Modify technical services</td><td>InterfaceVerifyRespFunctionEDA: e' stata ricevuta una risposta negativa '13003'</td></tr><tr><td>66078832342</td><td>Modify technical services</td><td>InterfaceVerifyRespFunctionEDA: e' stata ricevuta una risposta negativa '13003'</td></tr></tbody></table></div><p></p></div></div><div class="chapter-container" id="ID1715261801909"><div class="chapter-title">ESTRAZIONE RISORSE(ID1715261801909)</div><button class="chapter-button">Aggiungi Paragrafo</button><button class="chapter-button">Elimina Paragrafo</button><div class="section" id="ID1715261827681"><div class="section-column1"><div class="section-title">Estrazione action verso il mobile resource (ID1715261827681)</div><hr><pre><code class="language-sql">select a.name, c.name,b.name from 
request a, 
action b,
request c,
action_msg d
where 
d.id=b.message_id and
c.root_id=A.ID and
--c.name='Network' and
b.request_id=c.id and 
b.handler like '%mobileResource%' and
b.system in ('clarify','esb') and 
a.ts_created&gt;sysdate-70 and
a.name  in 
('Change-over'
/*'In Order',
'OutOrder', --==&gt; 
'Extend Order',
'Sim/Handset Change', --==&gt; 
'MnpDonor', --==&gt; 
'Change Number Mnp' --==&gt; 
*/) and
rownum&lt;3</code></pre></div><p></p><div class="section-column2"><table><thead><tr class="first-row"><th>NAME</th><th>NAME_1</th><th>NAME_2</th></tr></thead><tbody><tr><td>Change-over</td><td>Network</td><td>Update SIM</td></tr><tr><td>Change-over</td><td>Network</td><td>Update SIM</td></tr></tbody></table></div><p></p></div><div class="section" id="ID1715261855210"><div class="section-column1"><div class="section-title">Estrazione action verso billing dalla request id root (ID1715261855210)</div><hr><pre><code class="language-sql">select b.name,b.id,a.root_id,b.status,''''||b.id||''',',
(select distinct value from detail where root_id = a.root_id and name='id_odl_crm') id_ordine
from request a, action  b
      where 
      b.request_id=a.id and 
--      a.root_id in (     572744,     -1      )       
      a.root_id in (select distinct root_id from detail where value in       ('1-622831680560'))
--      and b.status ='SA'
      and b.system='kenan' 
     and b.direction='outbound'
     and b.id not in (-1)
     and rownum&lt;4</code></pre></div><p></p><div class="section-column2"><table><thead><tr class="first-row"><th>NAME</th><th>ID</th><th>ROOT_ID</th><th>STATUS</th><th>''''||B.ID||''','</th><th>ID_ORDINE</th></tr></thead><tbody><tr><td>Active Service Instance</td><td>69690794883</td><td>3498806946</td><td>SA</td><td>'69690794883',</td><td>1-622831680560</td></tr><tr><td>Change Billing Element Service Instance</td><td>69709332589</td><td>3498806946</td><td>SA</td><td>'69709332589',</td><td>1-622831680560</td></tr><tr><td>Change Number Service Instance</td><td>69690794278</td><td>3498806946</td><td>SA</td><td>'69690794278',</td><td>1-622831680560</td></tr></tbody></table></div><p></p></div></div></body></html>